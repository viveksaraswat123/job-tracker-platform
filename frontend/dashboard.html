<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Dashboard â€¢ Job Tracker</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

<style>
  body { background:#f5f5f7; font-family:Inter,Arial,sans-serif; }
  body.dark { background:#0f0f0f; color:#e5e5e5; }

  .navbar { background:#111827; color:white; }
  .glass { background:white; border-radius:20px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
  .glass.dark { background:#181818; border:1px solid #2a2a2a; }

  .status-badge { padding:4px 14px; border-radius:30px; font-size:12px; font-weight:600; }
  .status-Applied { background:#2563eb; color:white; }
  .status-Interview { background:#d97706; color:white; }
  .status-Rejected { background:#dc2626; color:white; }
  .status-Offer { background:#16a34a; color:white; }

  .timeline-item { border-left:3px solid #000; padding-left:12px; margin-bottom:10px; font-size:13px; }
</style>
</head>

<body id="body" class="transition-all">

<!-- Topbar -->
<nav class="navbar px-8 py-4 flex justify-between items-center">
  <h2 class="text-2xl font-bold">Job Tracker</h2>
  <div class="flex gap-3">
    <button onclick="toggleTheme()" class="bg-gray-700 px-3 py-1 text-xs rounded">Dark</button>
    <button onclick="goProfile()" class="bg-blue-600 px-4 py-2 text-sm rounded-lg">Profile</button>
    <button class="logout-btn bg-red-500 px-4 py-2 text-sm rounded-lg" onclick="logout()">Logout</button>
  </div>
</nav>

<main class="max-w-6xl mx-auto mt-8 px-6 grid grid-cols-1 lg:grid-cols-4 gap-6">

<!-- Sidebar -->
<aside class="glass p-5 text-left space-y-4">
  <h3 class="text-lg font-bold">Menu</h3>
  <button onclick="openModal()" class="w-full bg-black text-white py-2 rounded-lg text-sm">+ Add Application</button>
  <button onclick="showSection('stats-section')" class="w-full border py-2 rounded-lg text-sm">Stats</button>
  <button onclick="showSection('timeline-section')" class="w-full border py-2 rounded-lg text-sm">Activity</button>
  <button onclick="showSection('notes-section')" class="w-full border py-2 rounded-lg text-sm">Notes</button>
</aside>

<!-- Profile Quick Card -->
<div class="glass p-6 text-center">
  <img id="avatar-img" src="/static/default-avatar.png" class="w-16 h-16 mx-auto rounded-full object-cover shadow"/>
  <h4 id="user-name" class="text-lg font-bold mt-2">Vivek</h4>
  <p id="user-email" class="text-xs text-gray-500">--</p>
</div>

<!-- Stats Cards -->
<section id="stats-section" class="glass lg:col-span-2 grid grid-cols-2 md:grid-cols-3 gap-4">
  <div class="p-5 glass text-center"><p class="text-xs">Applied</p><p id="stat-applied" class="text-3xl font-bold">0</p></div>
  <div class="p-5 glass text-center"><p class="text-xs">Interview</p><p id="stat-interview" class="text-3xl font-bold">0</p></div>
  <div class="p-5 glass text-center"><p class="text-xs">Rejected</p><p id="stat-rejected" class="text-3xl font-bold">0</p></div>
  <div class="p-5 glass text-center"><p class="text-xs">Offers</p><p id="stat-offer" class="text-3xl font-bold">0</p></div>
  <div class="p-5 glass text-center"><p class="text-xs">Follow Ups</p><p id="stat-follow" class="text-3xl font-bold">0</p></div>
  <div class="p-5 glass text-center"><p class="text-xs">Total</p><p id="total-apps" class="text-3xl font-bold">0</p></div>
</section>

<!-- Activity Timeline -->
<section id="timeline-section" class="glass lg:col-span-3 hidden p-6">
  <h3 class="text-xl font-bold mb-3">Recent Activity</h3>
  <div id="timeline"></div>
</section>

<!-- Notes Section -->
<section id="notes-section" class="glass lg:col-span-3 hidden p-6">
  <h3 class="text-xl font-bold mb-3">Saved Notes</h3>
  <textarea id="notes" placeholder="Add recruiter name, feedback, follow-up logs..."
    class="border w-full h-32 p-4 rounded-xl text-sm"></textarea>
  <button onclick="saveNotes()" class="mt-3 w-full bg-black text-white py-2 rounded-lg text-sm">Save Notes</button>
  <p id="notes-msg" class="text-xs text-center mt-2 text-green-600"></p>
</section>

<!-- Job Cards Grid -->
<section id="cards-section" class="glass lg:col-span-3 p-6">
  <div class="flex flex-wrap justify-between items-center gap-3 mb-5">
    <h3 class="text-xl font-bold">Your Applications</h3>
    <input id="search" onkeyup="searchTable()" placeholder="Search company..."
      class="border px-3 py-2 rounded-lg text-sm w-full md:w-56"/>
    <select id="filter" onchange="filterStatus()" class="border px-3 py-2 rounded-lg text-sm w-full md:w-40">
      <option value="ALL">All</option>
      <option>Applied</option>
      <option>Interview</option>
      <option>Rejected</option>
      <option>Offer</option>
    </select>
  </div>

  <div id="cards" class="grid grid-cols-1 md:grid-cols-2 gap-5"></div>
</section>

</main>

<!-- ADD APPLICATION MODAL -->
<div id="modal" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex justify-center items-center hidden">
  <div class="glass p-6 w-full mx-6 md:w-[380px]">
    <h2 class="text-xl font-bold mb-3">Add Job Application</h2>
    <input id="company-input" placeholder="Company" class="border w-full px-4 py-2 rounded-lg text-sm mb-2"/>
    <input id="role-input" placeholder="Role" class="border w-full px-4 py-2 rounded-lg text-sm mb-2"/>
    <select id="status-input" class="border w-full px-4 py-2 rounded-lg text-sm mb-3">
      <option>Applied</option><option>Interview</option><option>Rejected</option><option>Offer</option>
    </select>
    <button onclick="addApplication()" class="w-full bg-black text-white py-2 rounded-lg text-sm">Save</button>
    <button onclick="closeModal()" class="w-full mt-2 border py-2 rounded-lg text-sm">Cancel</button>
    <p id="modal-msg" class="text-xs text-center text-red-500 mt-2"></p>
  </div>
</div>

<script>
const token = localStorage.getItem("token");
let jobs = JSON.parse(localStorage.getItem("jobs")) || [];

window.onload = ()=>{ loadProfile(); loadStats(); renderCards(); loadTimeline(); };

async function loadProfile(){
  const res = await fetch("/auth/profile", { headers:{ "Authorization":"Bearer "+token }});
  const u = await res.json();
  document.getElementById("user-name").innerText = u.name || "Add Name";
  document.getElementById("user-email").innerText = u.email;
  document.getElementById("avatar-img").src = u.avatar || "/static/default-avatar.png";
}

async function loadStats(){
  const res = await fetch("/auth/profile/stats", { headers:{ "Authorization":"Bearer "+token }});
  const s = await res.json();
  document.getElementById("stat-applied").innerText = s.applied;
  document.getElementById("stat-interview").innerText = s.interview;
  document.getElementById("stat-rejected").innerText = s.rejected;
  document.getElementById("stat-offer").innerText = s.offers;
  document.getElementById("total-apps").innerText = jobs.length;
  document.getElementById("total-apps").innerText = jobs.length;
}

function renderCards(list = jobs){
  const box = document.getElementById("cards");
  box.innerHTML = "";
  list.forEach((job, i)=>{
    box.innerHTML += `
    <div class="glass p-5 rounded-xl relative">
      <span class="status-badge status-${job.status}">${job.status}</span>
      <h4 class="text-lg font-bold mt-2">${job.company}</h4>
      <p class="text-sm">${job.role}</p>
      <p class="text-xs text-gray-500 mt-1">${job.date}</p>
      <button onclick="deleteJob(${i})" class="absolute top-2 right-2 text-red-500 text-xs">Delete</button>
    </div>`;
  });
}

function deleteJob(i){
  jobs.splice(i,1);
  localStorage.setItem("jobs", JSON.stringify(jobs));
  renderCards();
  loadStats();
}

async function loadTimeline(){
  const res = await fetch("/auth/profile/timeline", { headers:{ "Authorization":"Bearer "+token }});
  const list = await res.json();
  const box = document.getElementById("timeline");
  box.innerHTML = "";
  list.forEach(t=>{ box.innerHTML += `<div class="timeline-item">${t}</div>` });
}

function openModal(){ document.getElementById("modal").classList.remove("hidden"); }
function closeModal(){ document.getElementById("modal").classList.add("hidden"); }
function toggleTheme(){ document.getElementById("body").classList.toggle("dark"); }
function goProfile(){ window.location.href="/profile"; }
function saveNotes(){ localStorage.setItem("notes", document.getElementById("notes").value); }
</script>

</body>
</html>
