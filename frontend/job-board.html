<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Job Board • Job Tracker</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  .job-card { transition: transform 0.2s; cursor: pointer; }
  .job-card:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
</style>
</head>

<body class="bg-light">

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold" href="/">Job Tracker</a>
    <div class="d-flex">
      <a href="/dashboard" class="btn btn-outline-primary me-2">Dashboard</a>
      <button class="btn btn-outline-danger" onclick="logout()">Logout</button>
    </div>
  </div>
</nav>

<div class="container mt-4">
  <!-- Search and Filters -->
  <div class="card mb-4">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-4">
          <input id="search" type="text" class="form-control" placeholder="Search jobs..." onkeyup="filterJobs()">
        </div>
        <div class="col-md-3">
          <input id="location" type="text" class="form-control" placeholder="Location..." onkeyup="filterJobs()">
        </div>
        <div class="col-md-3">
          <select id="job-type" class="form-select" onchange="filterJobs()">
            <option value="">All Types</option>
            <option>full-time</option>
            <option>part-time</option>
            <option>contract</option>
          </select>
        </div>
        <div class="col-md-2">
          <button onclick="loadJobs()" class="btn btn-primary w-100">Search</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Job Listings -->
  <div id="jobs" class="row g-4">
    <!-- Jobs will be loaded here -->
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
const token = localStorage.getItem("token");

window.onload = ()=>{ loadJobs(); };

async function loadJobs(){
  const search = document.getElementById("search").value;
  const location = document.getElementById("location").value;
  const jobType = document.getElementById("job-type").value;

  let url = "/jobs/";
  const params = new URLSearchParams();
  if(search) params.append("search", search);
  if(location) params.append("location", location);
  if(params.toString()) url += "?" + params.toString();

  const res = await fetch(url);
  const jobs = await res.json();
  renderJobs(jobs);
}

function renderJobs(jobs){
  const box = document.getElementById("jobs");
  box.innerHTML = "";
  jobs.forEach(job=>{
    const card = document.createElement("div");
    card.className = "col-md-4";
    card.innerHTML = `
      <div class="card job-card h-100" onclick="viewJob(${job.id})">
        <div class="card-body">
          <h5 class="card-title">${job.title}</h5>
          <h6 class="card-subtitle mb-2 text-muted">${job.company}</h6>
          <p class="card-text">
            <small class="text-muted">${job.location} • ${job.job_type}</small><br>
            ${job.description.substring(0, 100)}...
          </p>
          <button onclick="applyToJob(event, ${job.id})" class="btn btn-primary">Apply Now</button>
        </div>
      </div>`;
    box.appendChild(card);
  });
}

function filterJobs(){
  clearTimeout(window.searchTimeout);
  window.searchTimeout = setTimeout(loadJobs, 500);
}

async function applyToJob(event, jobId){
  event.stopPropagation();
  
  if(!token){
    alert("Please login to apply");
    window.location.href="/login";
    return;
  }

  const coverLetter = prompt("Enter cover letter (optional):");
  const data = { job_id: jobId };
  if(coverLetter) data.cover_letter = coverLetter;

  const res = await fetch("/applications/", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + token
    },
    body: JSON.stringify(data)
  });

  if(res.ok){
    alert("Application submitted!");
  } else {
    const err = await res.json();
    alert(err.detail);
  }
}

function viewJob(jobId){
  // Could open a modal or redirect to job detail page
  console.log("View job", jobId);
}

function logout(){ localStorage.removeItem("token"); window.location.href="/"; }
</script>

</body>
</html>