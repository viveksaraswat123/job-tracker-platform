<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Profile â€¢ Job Tracker</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
</head>

<body id="body" class="bg-[#f5f5f7] text-gray-900 transition-all">

<!-- Banner + Profile Header -->
<section class="relative w-full h-48 bg-black">
  <div class="absolute -bottom-14 left-1/2 -translate-x-1/2">
    <img id="avatar-img" src="/static/default-avatar.png"
      class="w-28 h-28 rounded-full border-4 border-white shadow-lg object-cover"/>
    <input type="file" id="avatar" accept="image/*" class="hidden" onchange="uploadAvatar()"/>
    <button onclick="document.getElementById('avatar').click()"
      class="absolute bottom-1 right-2 bg-white text-black text-xs px-2 py-1 rounded-full shadow">
      Change Photo
    </button>
  </div>
</section>

<div class="max-w-5xl mx-auto mt-20 px-6">

  <h2 id="user-name" class="text-3xl font-bold text-center">Loading...</h2>
  <p id="user-email" class="text-center text-gray-500 text-sm mb-6">---</p>

  <!-- Stats -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center mb-8">
    <div class="bg-white p-4 rounded-2xl shadow"><p class="text-sm">Applied</p><p id="stat-applied" class="text-2xl font-bold">0</p></div>
    <div class="bg-white p-4 rounded-2xl shadow"><p class="text-sm">Interview</p><p id="stat-interview" class="text-2xl font-bold">0</p></div>
    <div class="bg-white p-4 rounded-2xl shadow"><p class="text-sm">Rejected</p><p id="stat-rejected" class="text-2xl font-bold">0</p></div>
    <div class="bg-white p-4 rounded-2xl shadow"><p class="text-sm">Offers</p><p id="stat-offer" class="text-2xl font-bold">0</p></div>
  </div>

  <!-- Main Card -->
  <div class="bg-white border border-gray-200 p-8 rounded-3xl shadow-xl">

    <h3 class="text-2xl font-bold mb-6">Personal Information</h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <div>
        <label class="font-semibold text-sm">Full Name</label>
        <input id="name" class="border w-full px-4 py-2 rounded-xl mt-1"/>
      </div>

      <div>
        <label class="font-semibold text-sm">Phone</label>
        <input id="phone" class="border w-full px-4 py-2 rounded-xl mt-1"/>
      </div>

      <div>
        <label class="font-semibold text-sm">Skills</label>
        <input id="skills" placeholder="Spring Boot, FastAPI, SQL, Python..."
          class="border w-full px-4 py-2 rounded-xl mt-1"/>
      </div>

      <div>
        <label class="font-semibold text-sm">Location</label>
        <input id="location" placeholder="Noida, India"
          class="border w-full px-4 py-2 rounded-xl mt-1"/>
      </div>

      <div>
        <label class="font-semibold text-sm">LinkedIn</label>
        <input id="linkedin" placeholder="linkedin.com/in/vivek"
          class="border w-full px-4 py-2 rounded-xl mt-1"/>
      </div>

      <div>
        <label class="font-semibold text-sm">GitHub</label>
        <input id="github" placeholder="github.com/viveksaraswat123"
          class="border w-full px-4 py-2 rounded-xl mt-1"/>
      </div>

      <div>
        <label class="font-semibold text-sm">Portfolio</label>
        <input id="portfolio" placeholder="myportfolio.dev"
          class="border w-full px-4 py-2 rounded-xl mt-1"/>
      </div>

      <div>
        <label class="font-semibold text-sm">Resume</label>
        <input type="file" id="resume" accept=".pdf,.docx"
          class="border w-full px-2 py-2 rounded-xl mt-1" onchange="uploadResume()"/>
        <a id="resume-link" target="_blank" class="text-blue-600 text-xs mt-1 block">No resume uploaded</a>
      </div>

    </div>

    <button onclick="updateProfile()" class="mt-8 w-full bg-black text-white py-3 rounded-xl font-semibold">
      Save Profile
    </button>

    <p id="msg" class="text-center text-sm text-green-600 mt-3"></p>

  </div>

  <!-- Timeline -->
  <div class="mt-10">
    <h3 class="text-xl font-bold mb-3">Application Timeline</h3>
    <div id="timeline" class="space-y-2"></div>
  </div>

</div>

<script>
const token = localStorage.getItem("token");

async function loadProfile(){
  const res = await fetch("/auth/profile", { headers:{ "Authorization":"Bearer "+token }});
  const u = await res.json();

  document.getElementById("user-name").innerText = u.name || "Add Your Name";
  document.getElementById("user-email").innerText = u.email;
  document.getElementById("avatar-img").src = u.avatar || "/static/default-avatar.png";
  document.getElementById("name").value = u.name || "";
  document.getElementById("phone").value = u.phone || "";
  document.getElementById("skills").value = u.skills || "";
  document.getElementById("location").value = u.location || "";
  document.getElementById("linkedin").value = u.linkedin || "";
  document.getElementById("github").value = u.github || "";
  document.getElementById("portfolio").value = u.portfolio || "";
  document.getElementById("resume-link").href = u.resume || "#";

  loadStats();
  loadTimeline();
}

async function loadStats(){
  const res = await fetch("/auth/profile/stats", { headers:{ "Authorization":"Bearer "+token }});
  const s = await res.json();
  document.getElementById("stat-applied").innerText = s.applied;
  document.getElementById("stat-interview").innerText = s.interview;
  document.getElementById("stat-rejected").innerText = s.rejected;
  document.getElementById("stat-offer").innerText = s.offers;
}

async function loadTimeline(){
  const res = await fetch("/auth/profile/timeline", { headers:{ "Authorization":"Bearer "+token }});
  const list = await res.json();
  const box = document.getElementById("timeline");
  box.innerHTML="";
  list.forEach(a=>{
    box.innerHTML += `<div class="bg-white p-3 rounded-xl shadow text-xs">${a}</div>`;
  });
}

async function updateProfile(){
  const payload = {
    name: document.getElementById("name").value,
    phone: document.getElementById("phone").value,
    skills: document.getElementById("skills").value,
    location: document.getElementById("location").value,
    linkedin: document.getElementById("linkedin").value,
    github: document.getElementById("github").value,
    portfolio: document.getElementById("portfolio").value
  };

  const res = await fetch("/auth/profile/update", {
    method:"PUT",
    headers:{ "Content-Type":"application/json","Authorization":"Bearer "+token },
    body: JSON.stringify(payload)
  });

  const d = await res.json();
  document.getElementById("msg").innerText = d.message;
}

async function uploadAvatar(){
  const file = document.getElementById("avatar").files[0];
  const form = new FormData();
  form.append("file", file);

  const res = await fetch("/auth/profile/avatar", { method:"POST", headers:{ "Authorization":"Bearer "+token }, body:form });
  const d = await res.json();
  document.getElementById("msg").innerText = d.message;
}

async function uploadResume(){
  const file = document.getElementById("resume").files[0];
  const form = new FormData();
  form.append("file", file);

  const res = await fetch("/auth/profile/resume", { method:"POST", headers:{ "Authorization":"Bearer "+token }, body:form });
  const d = await res.json();
  document.getElementById("msg").innerText = d.message;
}

gsap.from("section, nav, .bg-white", {y:30,opacity:0,duration:0.6,stagger:0.2});
loadProfile();
</script>

</body>
</html>
